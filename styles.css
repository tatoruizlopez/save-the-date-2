:root{
  --bg1:#fde7ef;
  --bg2:#f7d9e6;

  --ink:#2b2230;
  --muted:#6a556b;

  --card:#ffffffcc;
  --border:#ffffffa6;

  --gold1:#f6e6b6;
  --gold2:#e8c97a;
  --gold3:#caa24d;
}

*{ box-sizing:border-box; }
html,body{ height:100%; }

body{
  margin:0;
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  color:var(--ink);
  overflow-x: hidden;

  background:
    radial-gradient(900px 700px at 20% 20%, #fff 0%, transparent 60%),
    radial-gradient(900px 700px at 80% 30%, #fff 0%, transparent 60%),
    linear-gradient(140deg, var(--bg1), var(--bg2));
}

/* INTRO */
.intro-screen{
  position:fixed;
  inset:0;
  z-index:999;
  display:grid;
  place-items:center;
  overflow:hidden;
  cursor:pointer;
  user-select:none;
  -webkit-user-select:none;
  touch-action: manipulation;
}

.intro-bg{
  position:absolute;
  inset:0;
  background-image: url("assets/intro.jpg");
  background-size: cover;
  background-position: center;
  transform: scale(1.02);
  animation: kenburns 10s ease-in-out forwards;
  filter: saturate(1.05) contrast(1.02);
  transition: filter 260ms ease, transform 260ms ease;
}

.intro-screen.step2 .intro-bg{
  filter: blur(9px) saturate(1.05) contrast(1.02);
  transform: scale(1.14);
}

@keyframes kenburns{
  from{ transform: scale(1.02) translateY(0px); }
  to{ transform: scale(1.10) translateY(-14px); }
}

.intro-gradient{
  position:absolute;
  inset:0;
  background:
    radial-gradient(800px 600px at 50% 30%, rgba(255,255,255,0.28), rgba(255,255,255,0) 60%),
    linear-gradient(180deg, rgba(255,255,255,0.18) 0%, rgba(0,0,0,0.34) 70%, rgba(0,0,0,0.58) 100%);
}

.flash{
  position:absolute;
  inset:0;
  background:#fff;
  opacity:0;
  pointer-events:none;
}
.flash.on{ animation: flash 450ms ease-out forwards; }
@keyframes flash{
  0%{ opacity:0; }
  35%{ opacity:0.9; }
  100%{ opacity:0; }
}

.intro-content{
  position:relative;
  width:100%;
  max-width:520px;
  padding:
    calc(18px + env(safe-area-inset-top))
    calc(18px + env(safe-area-inset-right))
    calc(22px + env(safe-area-inset-bottom))
    calc(18px + env(safe-area-inset-left));
  text-align:center;
  color:#fff;
  display:flex;
  flex-direction:column;
  gap:12px;
  align-items:center;
  justify-content:flex-end;
  min-height:100dvh;
}

.intro-kicker{
  font-family:"Playfair Display", serif;
  font-weight:600;
  font-size:38px;
  text-shadow: 0 12px 30px rgba(0,0,0,.35);
  animation: floaty 2.8s ease-in-out infinite;
}

@keyframes floaty{
  0%,100%{ transform: translateY(0px); }
  50%{ transform: translateY(-6px); }
}

.intro-msg{
  opacity:0;
  transform: translateY(10px);
  transition: opacity 450ms ease, transform 450ms ease;
  text-shadow: 0 10px 26px rgba(0,0,0,.35);
  font-size:16px;
  color: rgba(255,255,255,0.95);
  min-height:44px;
}

.intro-tap{
  opacity:0;
  transform: translateY(10px);
  transition: opacity 450ms ease, transform 450ms ease;
  text-shadow: 0 10px 26px rgba(0,0,0,.35);

  margin-top:6px;
  font-size:13px;
  letter-spacing:.14em;
  text-transform:uppercase;
  color: rgba(255,255,255,0.90);
  padding:10px 14px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,0.40);
  background: rgba(0,0,0,0.18);
  backdrop-filter: blur(6px);
  animation: pulse 1.25s ease-in-out infinite;
}

@keyframes pulse{
  0%,100%{ transform: translateY(0px) scale(1); }
  50%{ transform: translateY(0px) scale(1.03); }
}

.show{
  opacity:1 !important;
  transform: translateY(0px) !important;
}

.caret{
  display:inline-block;
  margin-left:2px;
  opacity:0.9;
  animation: blink 800ms steps(1) infinite;
}
@keyframes blink{
  50%{ opacity:0; }
}

.intro-dismiss{ animation: introOut 520ms ease forwards; }
@keyframes introOut{
  to{ opacity:0; transform: scale(1.02); pointer-events:none; }
}

/* MAIN */
.main-screen{
  min-height:100dvh;
  display:grid;
  place-items:center;

  padding-top: calc(24px + env(safe-area-inset-top));
  padding-bottom: calc(24px + env(safe-area-inset-bottom));
  padding-left: calc(24px + env(safe-area-inset-left));
  padding-right: calc(24px + env(safe-area-inset-right));
}

.wrap{ width:100%; max-width:420px; margin: 0 auto; }

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:24px;
  backdrop-filter: blur(10px);
  box-shadow: 0 18px 55px rgba(20, 10, 25, .18);
  padding:22px 20px 18px;
}

.headline{ text-align:center; margin-bottom:14px; }

.small{
  letter-spacing:.22em;
  text-transform:uppercase;
  font-size:12px;
  color:var(--muted);
}

h1{
  font-family:"Playfair Display", serif;
  font-weight:600;
  font-size:38px;
  margin:8px 0 6px;
}

.amp{ font-family:"Playfair Display", serif; font-weight:500; }
.meta{ color:var(--muted); font-weight:400; }

.scratch-area{
  position:relative;
  width:100%;
  aspect-ratio: 1 / 1.05;
  border-radius:22px;
  overflow:hidden;
  border:1px solid #ffffffb3;
  background:
    radial-gradient(420px 320px at 50% 30%, #fff 0%, #fff0 65%),
    linear-gradient(180deg, #ffffffb8, #ffffff6b);
}

.heart-stage{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%, -50%) scale(0.92);
  width:min(380px, 90%);
  aspect-ratio: 1 / 0.92;
  display:grid;
  place-items:center;
}

/* Layers */
.layer{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
}

.base{ z-index:1; pointer-events:none; }
.heart-reveal{ z-index:2; pointer-events:none; }
.glitter{ z-index:3; touch-action:none; user-select:none; -webkit-user-select:none; }
.shine{ z-index:4; pointer-events:none; mix-blend-mode: screen; }
.particles{ z-index:5; pointer-events:none; }
.bevel{ z-index:6; pointer-events:none; }
.outline{ z-index:7; pointer-events:none; mix-blend-mode: screen; opacity:0; transform: scale(0.98); transition: opacity 380ms ease, transform 380ms ease; }
.outline.on{ opacity:1; transform: scale(1); }

.heart-reveal{
  opacity:1;
  transition: opacity 220ms ease;
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  text-align:center;
  padding:18px;
  max-width:86%;
  margin:0 auto;
  transform: translateY(-28px);
}

.heart-date{
  font-family:"Playfair Display", serif;
  font-weight:600;
  font-size:24px;
  line-height:1.05;
}

.heart-time{
  margin-top:6px;
  font-weight:500;
  font-size:20px;
  color:#3a2a44;
}

.heart-note{
  margin-top:6px;
  font-size:13px;
  color:var(--muted);
  letter-spacing:.02em;
}

.hint{
  position:absolute;
  left:12px;
  right:12px;
  bottom:12px;
  background:#ffffffcc;
  border:1px solid #ffffffc7;
  color:var(--muted);
  font-size:12px;
  border-radius:999px;
  padding:10px 12px;
  text-align:center;
  backdrop-filter: blur(6px);
  transition: opacity 200ms ease;
}

.footer{ margin-top:14px; text-align:center; font-size:13px; color:var(--muted); }

.below{
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:space-between;
  margin-top:14px;
  flex-wrap:wrap;
}

.btn{
  border:0;
  padding:10px 14px;
  border-radius:999px;
  background:#ffffffd9;
  box-shadow: 0 10px 25px rgba(20, 10, 25, .12);
  cursor:pointer;
  font-weight:500;
}

.tip{ font-size:12px; color:var(--muted); }

.music-status{
  flex-basis:100%;
  font-size:12px;
  color:var(--muted);
  margin-top:-2px;
  display:none;
}
.music-status.show{ display:block; }

/* POPUP */
.popup{
  position:fixed;
  inset:0;
  display:grid;
  place-items:center;
  background: rgba(0,0,0,0.25);
  opacity:0;
  pointer-events:none;
  transition: opacity 240ms ease;
  z-index:2000;
}
.popup.on{ opacity:1; pointer-events:auto; }

.popup-card{
  width:min(320px, calc(100vw - 48px));
  background:#ffffffea;
  border:1px solid #ffffffc7;
  border-radius:22px;
  padding:18px 18px 14px;
  text-align:center;
  box-shadow: 0 18px 55px rgba(20, 10, 25, .22);
  transform: scale(0.86);
  opacity:0;
  animation: popCard 520ms cubic-bezier(.2,.9,.2,1) forwards;
}
@keyframes popCard{ to{ transform: scale(1); opacity:1; } }

.popup-title{
  font-family:"Playfair Display", serif;
  font-weight:600;
  font-size:26px;
  letter-spacing:.02em;
  background: linear-gradient(90deg, var(--gold1), var(--gold2), var(--gold3));
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  filter: drop-shadow(0 10px 18px rgba(232,201,122,0.25));
}

.popup-sub{ margin-top:8px; font-size:18px; }

@media (max-width: 380px){
  h1{ font-size:34px; }
  .heart-stage{ width:min(350px, 96%); }
  .heart-reveal{ transform: translateY(-24px); }
  .intro-kicker{ font-size:34px; }
}